(this.webpackJsonpfrontend=this.webpackJsonpfrontend||[]).push([[0],{80:function(e,t,a){e.exports=a(93)},93:function(e,t,a){"use strict";a.r(t);var n=a(0),r=a.n(n),c=a(9),l=a(37),o=a.n(l),s=a(25),i=a(12),u=(a(85),a(62)),m=a.n(u),E=a(141),f=a(11),d=a(135),g=a(136),b=a(143),h=a(121),p=a(124),v=a(137),O=a(138),C=a(142),j=a(147);function S(e){return r.a.createElement(h.a,{container:!0,spacing:2},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(p.a,{variant:"h6"},"Select CA:")),r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(C.a,{value:e.caValue,fullWidth:!0,onChange:function(t){e.setCAValue(t.target.value)}},r.a.createElement(j.a,{value:"Lamassu-Root-CA1-RSA4096"},"Lamassu-Root-CA1-RSA4096"),r.a.createElement(j.a,{value:"Lamassu-Root-CA2-RSA2048"},"Lamassu-Root-CA2-RSA2048"),r.a.createElement(j.a,{value:"Lamassu-Root-CA3-ECC384"},"Lamassu-Root-CA3-ECC384"),r.a.createElement(j.a,{value:"Lamassu-Root-CA4-ECC256"},"Lamassu-Root-CA4-ECC256"))))}var x=a(145);function y(e){return r.a.createElement(h.a,{container:!0,spacing:2},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(p.a,{variant:"h6"},"Insert Certificate to authenticate:")),r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(x.a,{label:"Insert certificate here",multiline:!0,fullWidth:!0,rows:10,value:e.certValue,onChange:function(t){e.setCertValue(t.target.value)}})))}var A=a(3),k=a(148),R=a(132),w=a(133),L=a(129),N=a(130),W=a(131),z=a(134),V=a(128),B=Object(V.a)((function(e){return{root:{margin:e.spacing(1)},error:{backgroundColor:e.palette.error.dark},success:{backgroundColor:e.palette.success.dark},warning:{backgroundColor:e.palette.warning.dark},icon:{fontSize:20,opacity:.9,marginRight:e.spacing(1)},message:{display:"flex",alignItems:"center"}}}));function I(e){var t=Object(n.useState)(!0),a=Object(f.a)(t,2),c=a[0],l=a[1],o=function(){l(!1),e.setMessage(null)},s=B(),i=e.type,u=s[i];return r.a.createElement(k.a,{anchorOrigin:{vertical:"bottom",horizontal:"left"},open:c,onClose:o},r.a.createElement(R.a,{className:Object(A.a)(s.root,u),"aria-describedby":"client-snackbar",message:r.a.createElement("span",{id:"client-snackbar",className:s.message},function(){switch(i){case"error":return r.a.createElement(L.a,{className:s.icon});case"success":return r.a.createElement(N.a,{className:s.icon});case"warning":return r.a.createElement(W.a,{className:s.icon});default:return null}}(),e.message),action:[r.a.createElement(w.a,{key:"close","aria-label":"close",color:"inherit",onClick:o},r.a.createElement(z.a,{className:s.icon}))]}))}a(66);var T={url:"https://keycloak:8443/auth",realm:"lamassu",clientId:"lamassu-enroller",onLoad:"login-required"},M=null;function D(){return M.updateToken(30)}function G(){return M.token}function P(e){var t=Object(n.useState)(""),a=Object(f.a)(t,2),c=a[0],l=a[1],o=Object(n.useState)("Lamassu-Root-CA1-RSA4096"),s=Object(f.a)(o,2),i=s[0],u=s[1],m=Object(n.useState)(null),E=Object(f.a)(m,2),C=E[0],j=E[1],x=Object(n.useState)(!1),A=Object(f.a)(x,2),k=A[0],R=A[1],w=Object(n.useState)(null),L=Object(f.a)(w,2),N=L[0],W=L[1];Object(n.useEffect)((function(){var t=setInterval((function(){return D().success((function(){var a;(a=e.match.params.id,fetch("https://manufacturingenroll:8889/v1/csrs/"+a,{method:"GET",headers:{Authorization:"Bearer "+G()}})).then((function(a){a.ok?a.json().then((function(a){"APPROBED"!==a.status?(R(!1),W("Waiting to approbe CSR by Enroller, status is: "+a.status)):function(e){return fetch("https://manufacturingenroll:8889/v1/csrs/"+e+"/crt",{method:"GET",headers:{Authorization:"Bearer "+G()}})}(e.match.params.id).then((function(e){e.ok&&(e.text().then((function(e){l(e)})),clearInterval(t),R(!0),W(null))})).catch((function(e){return W(e.message)}))})):a.text().then((function(e){W(e),R(!1)}))})).catch((function(e){W(e.message)}))}))}),1e4)}),[e.match.params.id]);return r.a.createElement(d.a,{maxWidth:"md"},!k&&r.a.createElement(r.a.Fragment,null,r.a.createElement(g.a,{size:100}),r.a.createElement(I,{setMessage:function(){},message:"Waiting for Enroller response...",type:"warning"})),null!==N&&r.a.createElement(I,{setMessage:W,message:N,type:"error"}),null!==C&&r.a.createElement(I,{setMessage:j,message:C,type:"success"}),k&&r.a.createElement("form",{onSubmit:function(e){var t={crt:c,ca:i};D().success((function(){(function(e){return fetch("https://manufacturing:8888/v1/device/config",{method:"POST",body:JSON.stringify(e),headers:{Authorization:"Bearer "+G()}})})(t).then((function(e){e.ok?j("Configuration successfully loaded"):e.text().then((function(e){W(e)}))})).catch((function(e){return W(e.message)}))})),e.preventDefault()}},r.a.createElement(b.a,{border:1,p:4,borderRadius:"borderRadius"},r.a.createElement(h.a,{container:!0,spacing:2,justify:"center"},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(p.a,{variant:"h3"},"Configuration (Step 2)")),r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(v.a,null)),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(y,{setCertValue:l,certValue:c})),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(S,{setCAValue:u,caValue:i})),r.a.createElement(h.a,{item:!0,xs:3},r.a.createElement(O.a,{fullWidth:!0,type:"submit",variant:"contained",color:"primary"},"Set Configuration"))))))}var U=a(68);function J(e){var t=e.csr.ou,a=e.csr.mail,n=e.csr.csrpath;return r.a.createElement(r.a.Fragment,null,r.a.createElement(p.a,{variant:"subtitle1",component:"h2"},"ID: ",e.csr.id," CN: ",e.csr.cn," Status: ",e.csr.status),r.a.createElement(p.a,{variant:"body1",component:"h3"},"C: ",e.csr.c," ST: ",e.csr.st," L: ",e.csr.l," O: ",e.csr.o),r.a.createElement(p.a,{variant:"body2",component:"h4"},""!==t&&r.a.createElement("p",null,"OU: ",t," "),""!==a&&r.a.createElement("p",null,"EMAIL: ",a," "),""!==n&&r.a.createElement("p",null,"CSRFilePath: ",n)))}var F=Object(V.a)({root:{padding:"15px 15px 15px  15px",margin:"10px"}});function q(e){var t=F();return r.a.createElement(h.a,{item:!0,xs:4},r.a.createElement(U.a,{className:t.root},r.a.createElement(h.a,{container:!0,spacing:2},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(J,{csr:e.csr})),r.a.createElement(O.a,{component:s.b,to:"/config/".concat(e.csr.id),disabled:"NEW"!==e.csr.status&&"APPROBED"!==e.csr.status,color:"primary",variant:"contained",fullWidth:!0},"Select"))))}function K(){var e=Object(n.useState)(null),t=Object(f.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)(null),o=Object(f.a)(l,2),s=o[0],i=o[1],u=Object(n.useState)(null),m=Object(f.a)(u,2),E=m[0],O=m[1],C=function(){D().success((function(){fetch("https://manufacturingenroll:8889/v1/csrs",{method:"GET",headers:{Authorization:"Bearer "+G()}}).then((function(e){e.ok?e.json().then((function(e){void 0!==e.csr&&(O(!0),c(e.csr.csr))})):e.text().then((function(e){O(!1),i(e)}))})).catch((function(e){return i(e.message)}))}))};return Object(n.useEffect)((function(){C()}),[]),r.a.createElement(d.a,{maxWidth:"md"},null!==s&&r.a.createElement(I,{setMessage:i,message:s,type:"error"}),null===s&&!E&&null!==a&&r.a.createElement(g.a,null),null===s&&E&&null!==a&&r.a.createElement(b.a,{border:1,p:4,borderRadius:"borderRadius"},r.a.createElement(h.a,{container:!0,spacing:2},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(p.a,{variant:"h3"},"Configuration (Step 1)")),r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(v.a,null)),a.map((function(e){return r.a.createElement(q,{key:e.id.toString(),csr:e})})))))}var _=a(127),H=Object(V.a)((function(e){return{formControl:{margin:e.spacing(1),width:"100%"}}})),Q=new Map;function X(e){var t=Object(n.useState)([2048,4096,256,384]),a=Object(f.a)(t,2),c=a[0],l=a[1],o=H();return r.a.createElement(h.a,{container:!0,spacing:2},r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(p.a,{variant:"h6"},"Select key algorithm:"),r.a.createElement(_.a,{className:o.formControl},r.a.createElement(C.a,{value:e.algValue,onChange:function(t){e.setAlgValue(t.target.value),l(Q.get(t.target.value))}},r.a.createElement(j.a,{value:"RSA"},"RSA"),r.a.createElement(j.a,{value:"EC"},"EC")))),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(p.a,{variant:"h6"},"Select key bit size:"),r.a.createElement(_.a,{className:o.formControl},r.a.createElement(C.a,{value:e.sizeValue,onChange:function(t){e.setSizeValue(t.target.value)}},c.map((function(e,t){return r.a.createElement(j.a,{key:t,value:e},e)}))))),r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(p.a,{variant:"h6"},"Insert certificate properties:")),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(x.a,{fullWidth:!0,label:"Country name",onChange:function(t){e.setC(t.target.value)},value:e.c})),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(x.a,{fullWidth:!0,label:"State or province name",onChange:function(t){e.setST(t.target.value)},value:e.st})),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(x.a,{fullWidth:!0,label:"Locality name",onChange:function(t){e.setL(t.target.value)},value:e.l})),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(x.a,{fullWidth:!0,label:"Organization name",onChange:function(t){e.setO(t.target.value)},value:e.o})),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(x.a,{fullWidth:!0,label:"Organizational Unit name",onChange:function(t){e.setOU(t.target.value)},value:e.ou})),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(x.a,{fullWidth:!0,label:"Common name",onChange:function(t){e.setCN(t.target.value)},value:e.cn})),r.a.createElement(h.a,{item:!0,xs:6},r.a.createElement(x.a,{fullWidth:!0,label:"Email address",onChange:function(t){e.setEmail(t.target.value)},value:e.email})))}function Y(){var e=Object(n.useState)("ES"),t=Object(f.a)(e,2),a=t[0],c=t[1],l=Object(n.useState)("Gipuzkoa"),o=Object(f.a)(l,2),s=o[0],i=o[1],u=Object(n.useState)("Arrasate"),m=Object(f.a)(u,2),E=m[0],g=m[1],C=Object(n.useState)("LKS Next, S. Coop."),j=Object(f.a)(C,2),S=j[0],x=j[1],y=Object(n.useState)(""),A=Object(f.a)(y,2),k=A[0],R=A[1],w=Object(n.useState)("NewDevice"),L=Object(f.a)(w,2),N=L[0],W=L[1],z=Object(n.useState)(""),V=Object(f.a)(z,2),B=V[0],T=V[1],M=Object(n.useState)(2048),P=Object(f.a)(M,2),U=P[0],J=P[1],F=Object(n.useState)("RSA"),q=Object(f.a)(F,2),K=q[0],_=q[1],H=Object(n.useState)(null),Q=Object(f.a)(H,2),Y=Q[0],Z=Q[1];return r.a.createElement(d.a,{maxWidth:"md"},null!==Y&&r.a.createElement(I,{setMessage:Z,message:Y,type:"error"}),r.a.createElement("form",{onSubmit:function(e){var t={keyAlg:K,keySize:Math.trunc(U),c:a,st:s,l:E,o:S,ou:k,cn:N,email:B};D().success((function(){(function(e){return fetch("https://manufacturing:8888/v1/device",{method:"POST",body:JSON.stringify(e),headers:{Authorization:"Bearer "+G()}})})(t).then((function(e){e.ok?e.blob().then((function(e){Z(null);var a=window.URL.createObjectURL(new Blob([e])),n=document.createElement("a");n.href=a,n.setAttribute("download","".concat(t.cn,".pem")),document.body.appendChild(n),n.click(),n.parentNode.removeChild(n)})):e.text().then((function(e){Z(e)}))})).catch((function(e){return Z(e.message)}))})),e.preventDefault()}},r.a.createElement(b.a,{border:1,p:4,borderRadius:"borderRadius"},r.a.createElement(h.a,{container:!0,spacing:2,justify:"center"},r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(p.a,{variant:"h3"},"Operation")),r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(v.a,null)),r.a.createElement(h.a,{item:!0,xs:12},r.a.createElement(X,{setC:c,c:a,setST:i,st:s,setL:g,l:E,setO:x,o:S,setOU:R,ou:k,setCN:W,cn:N,setEmail:T,email:B,setSizeValue:J,sizeValue:U,setAlgValue:_,algValue:K})),r.a.createElement(h.a,{item:!0,xs:3},r.a.createElement(O.a,{fullWidth:!0,type:"submit",variant:"contained",color:"primary"},"Get Certificate"))))))}function Z(){var e=Object(i.g)().pathname;return Object(n.useEffect)((function(){window.scrollTo(0,0)}),[e]),null}Q.set("RSA",[2048,4096]),Q.set("EC",[256,384]);var $=a(139),ee=a(140),te=a(149),ae=Object(V.a)((function(e){return{root:{flexGrow:1,backgroundColor:e.palette.background.default,marginBottom:e.spacing(2)},menuButton:{marginRight:e.spacing(2)},toolbar:{borderBottom:"1px solid ".concat(e.palette.divider)},typoAppBarTitle:{flexGrow:1,marginLeft:e.spacing(1)}}}));function ne(){var e=ae();return r.a.createElement("div",{className:e.root},r.a.createElement($.a,{position:"static",color:"inherit",elevation:0},r.a.createElement(ee.a,{className:e.toolbar},r.a.createElement(te.a,{variant:"square",alt:"Lamassu Logo",src:"lamassu_logo.png"}),r.a.createElement(p.a,{variant:"h6",noWrap:!0,className:e.typoAppBarTitle},"Lamassu Device Manufacturing System"),r.a.createElement(O.a,{component:s.b,to:"/",replace:!0,variant:"text"},"Configuration"),r.a.createElement(O.a,{component:s.b,to:"/operation",replace:!0,variant:"text"},"Operation"))))}m.a.config(),(M=new window.Keycloak({url:T.url,realm:T.realm,clientId:T.clientId})).init({onLoad:T.onLoad}).success((function(e){e?Object(c.render)(r.a.createElement(s.a,null,r.a.createElement(E.a,null),r.a.createElement(ne,null),r.a.createElement(Z,null),r.a.createElement(i.d,null,r.a.createElement(i.b,{exact:!0,path:"/",render:function(e){return r.a.createElement(K,Object.assign({key:o()()},e))}}),r.a.createElement(i.b,{path:"/config/:id",render:function(e){return r.a.createElement(P,Object.assign({key:o()()},e))}}),r.a.createElement(i.b,{exact:!0,path:"/operation",render:function(e){return r.a.createElement(Y,Object.assign({key:o()()},e))}}))),document.getElementById("root")):window.location.reaload()}))}},[[80,1,2]]]);
//# sourceMappingURL=main.f3da8204.chunk.js.map